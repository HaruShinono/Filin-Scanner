<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Scan Report - {{ scan.target_url }}</title>
    <style>
        @page { size: A4; margin: 2cm; }
        body { font-family: "Helvetica", sans-serif; color: #333; line-height: 1.5; font-size: 12px; }
        h1 { color: #2c3e50; border-bottom: 2px solid #2c3e50; padding-bottom: 10px; }
        h2 { color: #e74c3c; margin-top: 20px; border-bottom: 1px solid #ddd; }
        h3 { color: #34495e; margin-top: 15px; }
        .badge { padding: 3px 6px; border-radius: 3px; color: white; font-weight: bold; font-size: 10px; }
        .critical { background-color: #721c24; }
        .high { background-color: #dc3545; }
        .medium { background-color: #ffc107; color: #000; }
        .low { background-color: #17a2b8; }
        .info { background-color: #6c757d; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        code { background-color: #f8f9fa; padding: 2px 4px; font-family: monospace; font-size: 11px; word-break: break-all; }
        .summary-box { background: #f8f9fa; padding: 15px; border: 1px solid #ddd; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div style="text-align: center; margin-bottom: 30px;">
        <h1>Vulnerability Scan Report</h1>
        <p>Generated by Web Vulnerability Scanner</p>
    </div>

    <div class="summary-box">
        <h3>Executive Summary</h3>
        <p><strong>Target:</strong> {{ scan.target_url }}</p>
        <p><strong>Scan Date:</strong> {{ scan.start_time.strftime('%Y-%m-%d %H:%M:%S') }}</p>
        <p><strong>Duration:</strong>
            {% if scan.end_time %}
                {{ ((scan.end_time - scan.start_time).total_seconds() / 60)|round(2) }} minutes
            {% else %}
                N/A
            {% endif %}
        </p>
        <p><strong>Total Vulnerabilities:</strong> {{ scan.vulnerabilities|length }}</p>
    </div>

    <!-- Recon Findings -->
    {% if scan.recon_findings %}
    <h2>Reconnaissance Findings</h2>
    <table>
        <thead>
            <tr>
                <th width="15%">Tool</th>
                <th width="20%">Type</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody>
            {% for finding in scan.recon_findings %}
            <tr>
                <td>{{ finding.tool }}</td>
                <td>{{ finding.finding_type }}</td>
                <td><code style="white-space: pre-wrap;">{{ finding.get_details_as_dict() }}</code></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}

    <!-- Vulnerabilities -->
    <h2>Vulnerabilities Detail</h2>
    {% for vuln in scan.vulnerabilities %}
        <div style="margin-bottom: 20px; page-break-inside: avoid;">
            <h3>
                <span class="badge {{ vuln.severity|lower }}">{{ vuln.severity }}</span>
                {{ vuln.type }}
            </h3>
            <p><strong>URL:</strong> <code>{{ vuln.url }}</code></p>
            {% if vuln.subcategory %}
                <p><strong>Category:</strong> {{ vuln.subcategory }}</p>
            {% endif %}

            <div style="background: #fdfdfd; border-left: 3px solid #ccc; padding: 10px;">
                <strong>Details:</strong><br>
                <code style="white-space: pre-wrap;">{{ vuln.get_details_as_dict() | tojson(indent=2) }}</code>
            </div>
        </div>
        <hr style="border: 0; border-top: 1px dashed #eee;">
    {% endfor %}

</body>
</html>